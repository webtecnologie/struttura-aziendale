<!DOCTYPE html>
<html lang="{{ page.lang | default: 'it' }}">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ page.title | default: site.title }} ‚Äî {{ site.brand.name }}</title>

  <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fluentui/svg-icons/fonts/fluent-icons.css">
  <meta name="color-scheme" content="light dark" />
</head>

<body class="wt-body">

  {%- comment -%}
  LANGUAGE DETECTION:
  - Prioritize page.lang
  - Fallback: check if URL starts with /en/
  {%- endcomment -%}

  {%- assign is_en = false -%}
  {%- if page.lang == 'en' -%}
  {%- assign is_en = true -%}
  {%- else -%}
  {%- if page.url contains '/en/' -%}
  {%- assign is_en = true -%}
  {%- endif -%}
  {%- endif -%}

  {%- comment -%}
  Simple i18n mapping for common pages if they don't follow exact path matching
  {%- endcomment -%}
  {%- assign current_path = page.url | default: '/' -%}

  {%- if is_en -%}
  {%- assign url_en = current_path -%}
  {%- if current_path == '/en/' -%}
  {%- assign url_it = '/' -%}
  {%- elsif current_path contains '/en/services/' -%}
  {%- assign url_it = '/servizi/' -%}
  {%- elsif current_path contains '/en/projects/' -%}
  {%- assign url_it = '/progetti/' -%}
  {%- elsif current_path contains '/en/contact/' -%}
  {%- assign url_it = '/contatti/' -%}
  {%- else -%}
  {%- assign url_it = current_path | replace: '/en/', '/' -%}
  {%- endif -%}
  {%- else -%}
  {%- assign url_it = current_path -%}
  {%- if current_path == '/' -%}
  {%- assign url_en = '/en/' -%}
  {%- elsif current_path contains '/servizi/' -%}
  {%- assign url_en = '/en/services/' -%}
  {%- elsif current_path contains '/progetti/' -%}
  {%- assign url_en = '/en/projects/' -%}
  {%- elsif current_path contains '/contatti/' -%}
  {%- assign url_en = '/en/contact/' -%}
  {%- else -%}
  {%- assign url_en = '/en' | append: current_path -%}
  {%- endif -%}
  {%- endif -%}

  {%- assign en_enabled = site.data.i18n.en_enabled | default: true -%}

  <!-- HEADER -->
  <header class="wt-header">
    <div class="wt-container wt-nav">

      <!-- BRAND -->
      <div class="wt-brand">
        <a href="{{ '/' | relative_url }}" class="wt-brand-link">
          {% if site.brand.logo %}
          <img src="{{ site.brand.logo | relative_url }}" alt="Logo" class="wt-logo">
          {% endif %}
          <span class="wt-brand-text">{{ site.brand.name }}</span>
        </a>
      </div>

      <!-- NAV DESKTOP (TABS STYLE) -->
      {% if is_en %}
      {% assign nav_items = site.nav_en %}
      {% else %}
      {% assign nav_items = site.nav %}
      {% endif %}

      <nav class="wt-menu" role="tablist">
        {% for item in nav_items %}
        <a href="{{ item.url | relative_url }}" class="wt-nav-item {% if page.url == item.url %}active{% endif %}"
          role="tab">
          {{ item.name }}
        </a>
        {% endfor %}
      </nav>

      <!-- LANGUAGE SWITCHER & THEME -->
      <div class="wt-actions">
        <div class="wt-lang">
          <a class="wt-lang-item {% unless is_en %}active{% endunless %}" href="{{ url_it | relative_url }}">IT</a>
          <span class="wt-lang-sep">|</span>
          {% if en_enabled %}
          <a class="wt-lang-item {% if is_en %}active{% endif %}" href="{{ url_en | relative_url }}">EN</a>
          {% else %}
          <span class="wt-lang-item wt-disabled">EN</span>
          {% endif %}
        </div>

        <button class="wt-theme-toggle" onclick="WT.toggleTheme()" aria-label="Toggle Theme">
          <span class="wt-theme-ico wt-sun">‚òÄÔ∏è</span>
          <span class="wt-theme-ico wt-moon">üåô</span>
        </button>

        <button class="wt-burger" onclick="WT.toggleSidebar()" aria-label="Menu">‚ò∞</button>
      </div>

    </div>
  </header>

  <!-- SIDEBAR MOBILE -->
  <aside id="wt-sidebar" class="wt-sidebar" aria-hidden="true">
    <div class="wt-sidebar-head">
      <strong>Menu</strong>
      <button onclick="WT.toggleSidebar()">√ó</button>
    </div>

    <nav class="wt-sidebar-links">
      {% for item in nav_items %}
      <a href="{{ item.url | relative_url }}" {% if page.url==item.url %}class="active" {% endif %}>{{ item.name }}</a>
      {% endfor %}
    </nav>

    <div class="wt-sidebar-footer">
      <div class="wt-lang wt-lang-mobile">
        <a class="wt-lang-item {% unless is_en %}active{% endunless %}" href="{{ url_it | relative_url }}">IT</a>
        <span class="wt-lang-sep">|</span>
        {% if en_enabled %}
        <a class="wt-lang-item {% if is_en %}active{% endif %}" href="{{ url_en | relative_url }}">EN</a>
        {% else %}
        <span class="wt-lang-item wt-disabled">EN</span>
        {% endif %}
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="wt-main wt-container">
    {{ content }}
  </main>

  <!-- FOOTER -->
  <footer class="wt-footer">
    <div class="wt-container">
      <p>¬© {{ site.time | date: "%Y" }} {{ site.brand.name }} ‚Äî {% if is_en %}All rights reserved{% else %}Tutti i
        diritti riservati{% endif %}</p>
    </div>
  </footer>

  <script src="{{ '/assets/js/site.js' | relative_url }}"></script>
  <script>
    if (window.WT && WT.applyStoredTheme) WT.applyStoredTheme();
  </script>

</body>

</html>