<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ page.title | default: site.title }}</title>

  <!-- CSS del sito -->
  <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}" />

  <!-- Icone Fluent (opzionali) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fluentui/svg-icons/fonts/fluent-icons.css" />

  <!-- Permetti a browser/OS di usare light/dark -->
  <meta name="color-scheme" content="light dark" />
</head>

<body class="wt-body">

  <!-- HEADER -->
  <header class="wt-header">
    <div class="wt-container wt-nav" role="navigation" aria-label="Navigazione principale">

      <!-- BRAND -->
      <div class="wt-brand">
        <a class="wt-brand-link" href="{{ '/' | relative_url }}" aria-label="{{ site.brand.name }}">
          {% if site.brand.logo %}
            <img src="{{ site.brand.logo | relative_url }}"
                 class="wt-logo"
                 alt="Logo {{ site.brand.name }}"
                 data-logo-light="{{ site.brand.logo | relative_url }}"
                 {% if site.brand.logo_dark %} data-logo-dark="{{ site.brand.logo_dark | relative_url }}" {% endif %} />
          {% endif %}
          <span class="wt-brand-text">{{ site.brand.name }}</span>
        </a>
      </div>

      {%- comment -%}
        LANGUAGE SWITCHER ROBUSTO:
        - Calcola gli URL IT/EN in base alla pagina corrente (page.url).
        - Se la lingua EN non è abilitata (docs/_data/i18n.yml: en_enabled: false),
          mostra EN disabilitato (no 404).
      {%- endcomment -%}
      {%- assign current_url = page.url | default: '/' -%}
      {%- assign is_en = current_url | slice: 0,4 == '/en/' -%}
      {%- if is_en -%}
        {%- assign url_it = current_url | remove_first: '/en' -%}
        {%- assign url_en = current_url -%}
      {%- else -%}
        {%- assign url_it = current_url -%}
        {%- assign url_en = '/en' | append: current_url -%}
      {%- endif -%}

      <!-- LANGUAGE SWITCHER -->
      <div class="wt-lang">
        <a class="wt-lang-item {% if page.lang == 'it' or page.lang == nil %}active{% endif %}" href="{{ url_it | relative_url }}">IT</a>
        <span class="wt-lang-sep">|</span>
        {% if site.data.i18n and site.data.i18n.en_enabled %}
          <a class="wt-lang-item {% if page.lang == 'en' %}active{% endif %}" href="{{ url_en | relative_url }}">EN</a>
        {% else %}
          <span class="wt-lang-item wt-disabled" title="Coming soon">EN</span>
        {% endif %}
      </div>

      <!-- BURGER per MOBILE -->
      <button class="wt-burger" type="button" aria-label="Apri/chiudi menu" onclick="WT.toggleSidebar()">☰</button>

      <!-- MENU DESKTOP -->
      <nav class="wt-menu" aria-label="Menu">
        {% for item in site.nav %}
          <a href="{{ item.url | relative_url }}">{{ item.name }}</a>
        {% endfor %}
      </nav>

    </div>
  </header>

  <!-- SIDEBAR MOBILE -->
  <aside id="wt-sidebar" class="wt-sidebar" aria-label="Menu laterale" aria-hidden="true">

    <div class="wt-sidebar-head">
      <strong>Menu</strong>
      <button type="button" aria-label="Chiudi" onclick="WT.toggleSidebar()">×</button>
    </div>

    <nav class="wt-sidebar-links">
      {% for item in site.nav %}
        <a href="{{ item.url | relative_url }}">{{ item.name }}</a>
      {% endfor %}
    </nav>

    <!-- LANGUAGE SWITCHER mobile -->
    <div class="wt-sidebar-theme">
      <div class="wt-lang">
        <a class="wt-lang-item {% if page.lang == 'it' or page.lang == nil %}active{% endif %}" href="{{ url_it | relative_url }}">IT</a>
        <span class="wt-lang-sep">|</span>
        {% if site.data.i18n and site.data.i18n.en_enabled %}
          <a class="wt-lang-item {% if page.lang == 'en' %}active{% endif %}" href="{{ url_en | relative_url }}">EN</a>
        {% else %}
          <span class="wt-lang-item wt-disabled" title="Coming soon">EN</span>
        {% endif %}
      </div>
    </div>

  </aside>

  <!-- MAIN -->
  <main class="wt-main wt-container">
    {{ content }}
  </main>

  <!-- FOOTER -->
  <footer class="wt-footer">
    <div class="wt-container">
      © {{ site.time | date: "%Y" }} {{ site.brand.name }} — Tutti i diritti riservati
    </div>
  </footer>

  <!-- JS -->
  <script src="{{ '/assets/js/site.js' | relative_url }}"></script>
  <script>
    if (window.WT && WT.applyStoredTheme) WT.applyStoredTheme();
  </script>

</body>
</html>
